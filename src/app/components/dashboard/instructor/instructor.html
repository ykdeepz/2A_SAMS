<div class="layout">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo-circle">LOGO</div>
      <h2>Instructor</h2>
    </div>

    <nav class="sidebar-nav">
      <a class="nav-item" [class.active]="activeSection === 'dashboard'" (click)="setActiveSection('dashboard')">Dashboard</a>
      <a class="nav-item" [class.active]="activeSection === 'subjects'" (click)="setActiveSection('subjects')">My Subjects</a>
      <a class="nav-item">Attendance</a>
      <a class="nav-item">Reports</a>
      <a class="nav-item">Settings</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">

    <!-- Topbar -->
    <header class="topbar">
      <h1>Instructor Portal</h1>
      <button class="logout-btn" (click)="logout()">
  		Logout
	</button>
    </header>

    <!-- Dashboard Content -->
    <div class="dashboard-content" *ngIf="activeSection === 'dashboard'">

      <!-- Top Stats Section -->
      <section class="stats-section">
        <div class="stats-container">
          <div class="stat-card present">
            <h3>In Attendance</h3>
            <p class="stat-value">{{ getTodayAttendanceStats().presentPercent }}%</p>
            <p class="stat-number">{{ getTodayAttendanceStats().present }} students</p>
          </div>
          <div class="stat-card absent">
            <h3>Absent</h3>
            <p class="stat-value">{{ getTodayAttendanceStats().absentPercent }}%</p>
            <p class="stat-number">{{ getTodayAttendanceStats().absent }} students</p>
          </div>
          <div class="stat-card late">
            <h3>Late</h3>
            <p class="stat-value">{{ getTodayAttendanceStats().latePercent }}%</p>
            <p class="stat-number">{{ getTodayAttendanceStats().late }} students</p>
          </div>
        </div>
      </section>

      <!-- Today's Attendance Summary -->
      <section class="attendance-summary">
        <h2>Today's Attendance Summary</h2>
      </section>

      <!-- My Subjects Section -->
      <section class="subjects-section">
        <div class="subjects-grid">
          <div class="subject-card" *ngFor="let subject of subjects.slice(0, 2)">
            <div class="subject-info">
              <div class="subject-header">
                <span class="subject-code">{{ subject.code }}</span>
                <span class="subject-name">{{ subject.name }}</span>
              </div>
              <p class="subject-time">{{ subject.schedule.time }}</p>
              <p class="subject-room">Room {{ subject.schedule.room || 'TBA' }}</p>
              <p class="subject-section">BSIT 3R2</p>
            </div>
            <button class="view-report-btn" (click)="checkAttendance(subject)">VIEW ATTENDANCE REPORT</button>
          </div>
        </div>
      </section>

      <!-- QR Scanner Section -->
      <section class="scanner-section">
        <div class="scanner-card">
          <h3>QR Scanner</h3>
          <div class="webcam-box" *ngIf="!showScanner">
            <span>Webcam not available</span>
          </div>
          <zxing-scanner *ngIf="showScanner" (scanSuccess)="onScanSuccess($event)"></zxing-scanner>
          <div class="scanner-actions">
            <button class="scan-btn" (click)="scanQR()">Scan QR Code</button>
            <button class="manual-btn" (click)="showScanner = false">Manual Entry</button>
          </div>
        </div>
      </section>

    </div>

    <!-- Subjects Content -->
    <div class="dashboard-container" *ngIf="activeSection === 'subjects'">
      <div class="subjects-header">
        <h2>My Subjects</h2>
        <button class="create-btn" *ngIf="!selectedSubject" (click)="showCreateSubject = !showCreateSubject">
          <span class="btn-icon">+</span>
          Create New Subject
        </button>
      </div>

      <div *ngIf="showCreateSubject" class="create-form">
        <input [(ngModel)]="newSubject.name" placeholder="Subject Name" />
        <input [(ngModel)]="newSubject.code" placeholder="Subject Code" />
        <input [(ngModel)]="newSubject.schedule.days" placeholder="Days (comma separated)" />
        <input [(ngModel)]="newSubject.schedule.time" placeholder="Time" />
        <input [(ngModel)]="newSubject.schedule.room" placeholder="Room" />
        <button (click)="createSubject()">Create</button>
        <button (click)="showCreateSubject = false">Cancel</button>
      </div>

      <!-- Subjects Grid View -->
      <div class="subjects-grid" [class.blurred]="selectedSubject">
        <div class="subject-card" *ngFor="let subject of subjects" (click)="selectSubject(subject)">
          <div class="subject-info">
            <h3>{{ subject.name }}</h3>
            <p class="subject-code">{{ subject.code }}</p>
            <p class="subject-meta">{{ subject.enrolledStudents.length }} students</p>
          </div>
          <div class="subject-schedule">
            <p class="schedule-time">{{ subject.schedule.time }}</p>
            <p class="schedule-room">{{ subject.schedule.room || 'TBA' }}</p>
          </div>
        </div>
      </div>

      <!-- Subject Focus Overlay -->
      <div class="subject-focus-overlay" *ngIf="selectedSubject">
        <div class="subject-focus-panel">
          <div class="focus-header">
            <button class="back-btn" (click)="deselectSubject()">
              <span class="back-icon">‚Üê</span>
              Back to Subjects
            </button>
          </div>

          <div class="focus-content">
            <div class="subject-header-large">
              <h2>{{ selectedSubject.name }}</h2>
              <p class="subject-code-large">{{ selectedSubject.code }}</p>
            </div>

            <div class="subject-details">
              <div class="detail-item">
                <span class="detail-label">Schedule:</span>
                <span class="detail-value">{{ selectedSubject.schedule.days.join(', ') }} at {{ selectedSubject.schedule.time }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Room:</span>
                <span class="detail-value">{{ selectedSubject.schedule.room || 'TBA' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Enrolled Students:</span>
                <span class="detail-value">{{ selectedSubject.enrolledStudents.length }}</span>
              </div>
            </div>

            <div class="focus-actions">
              <button class="action-btn primary" (click)="showAttendance = !showAttendance">
                <span class="btn-icon">üìä</span>
                Take Attendance
              </button>
            </div>

            <div *ngIf="showAttendance" class="attendance-form">
              <h4>Mark Attendance for Today</h4>
              <div *ngFor="let student of students" class="attendance-item">
                <span>{{ student.name }} ({{ student.studentId }})</span>
                <label><input type="radio" [name]="'status-' + student.id" value="present" [(ngModel)]="attendanceStatus[student.id]" /> Present</label>
                <label><input type="radio" [name]="'status-' + student.id" value="late" [(ngModel)]="attendanceStatus[student.id]" /> Late</label>
                <label><input type="radio" [name]="'status-' + student.id" value="absent" [(ngModel)]="attendanceStatus[student.id]" /> Absent</label>
              </div>
              <button class="action-btn" (click)="recordAttendance()">Save Attendance</button>
            </div>

            <div class="add-student">
              <h4>Add Student to Class</h4>
              <div class="student-search-container">
                <input 
                  type="text" 
                  [(ngModel)]="newStudentId" 
                  (input)="searchStudent()"
                  placeholder="Enter Student ID (e.g., 2024001)" 
                  name="studentId"
                />
                <button (click)="scanQR()" type="button" class="scan-qr-btn">Scan QR</button>
                <button (click)="clearStudentSearch()" type="button" class="clear-btn" *ngIf="newStudentId">Clear</button>
              </div>
              
              <p class="search-message" [style.color]="studentSearchMessageColor" *ngIf="studentSearchMessage">
                {{ studentSearchMessage }}
              </p>

              <!-- Student Preview Card -->
              <div class="student-preview" *ngIf="foundStudent">
                <div class="preview-header">
                  <h4>Student Details</h4>
                </div>
                <div class="preview-content">
                  <div class="preview-row">
                    <label>Name:</label>
                    <span>{{ foundStudent.name }}</span>
                  </div>
                  <div class="preview-row">
                    <label>Student ID:</label>
                    <span>{{ foundStudent.studentId }}</span>
                  </div>
                  <div class="preview-row">
                    <label>Email:</label>
                    <span>{{ foundStudent.email }}</span>
                  </div>
                  <div class="preview-row" *ngIf="foundStudent.location">
                    <label>Location:</label>
                    <span>{{ foundStudent.location.address }}</span>
                  </div>
                  <div class="preview-actions">
                    <button (click)="addStudent()" type="button" class="add-btn">Add to Class</button>
                  </div>
                </div>
              </div>
            </div>

            <ul class="students-list">
              <li *ngFor="let student of students">
                {{ student.name }} ({{ student.studentId }})
                <button (click)="removeStudent(student.id)">Remove</button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- QR Scanner -->
      <div *ngIf="showScanner" class="qr-scanner">
        <zxing-scanner (scanSuccess)="onScanSuccess($event)"></zxing-scanner>
        <button (click)="showScanner = false">Close Scanner</button>
      </div>
    </div>

  </main>

</div>