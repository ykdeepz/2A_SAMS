<div class="subject-detail-container">
  @if (subject()) {
    <div class="detail-header">
      <div class="header-info">
        <h2 class="page-title">{{subject()!.subject_name}}</h2>
        <p class="subject-code">{{subject()!.subject_code}}</p>
      </div>
      <button (click)="router.navigate(['/take-attendance'])"
              class="btn-take-attendance">
        Take Attendance
      </button>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs-header">
        <button (click)="activeTab.set('students')"
                [class]="activeTab() === 'students' ? 'tab-button active' : 'tab-button'">
          Enrolled Students
        </button>
        <button (click)="activeTab.set('attendance')"
                [class]="activeTab() === 'attendance' ? 'tab-button active' : 'tab-button'">
          Attendance Records
        </button>
      </div>

      <div class="tab-content">
        @if (activeTab() === 'students') {
          <div class="list-container">
            <button (click)="showEnrollModal.set(true)"
                    class="btn-enroll">
              + Enroll Student
            </button>
            @for (enrollment of enrollments(); track enrollment.enrollment_id) {
              <div class="list-item">
                <div class="item-info">
                  <p class="item-name">{{enrollment.student_name}}</p>
                  <p class="item-meta">Enrolled: {{formatDate(enrollment.enrolled_date)}}</p>
                </div>
                <button (click)="unenroll(enrollment.enrollment_id)"
                        class="btn-unenroll">
                  Unenroll
                </button>
              </div>
            } @empty {
              <p class="empty-state">No students enrolled</p>
            }
          </div>
        }

        @if (activeTab() === 'attendance') {
          <div class="list-container">
            @for (record of subjectAttendance(); track record.attendance_id) {
              <div class="list-item">
                <div class="item-info">
                  <p class="item-name">{{record.student_name}}</p>
                  <p class="item-meta">{{formatDate(record.date)}} - {{record.time}}</p>
                </div>
                <span [class]="getStatusClass(record.status)">{{record.status}}</span>
              </div>
            } @empty {
              <p class="empty-state">No attendance records</p>
            }
          </div>
        }
      </div>
    </div>
  }
</div>

<!-- Enroll Modal -->
@if (showEnrollModal()) {
  <div class="modal-overlay">
    <div class="modal-content">
      <h3 class="modal-title">Enroll Student</h3>
      <div class="student-list">
        @for (student of availableStudents(); track student.student_id) {
          <button (click)="enrollStudent(student)"
                  class="student-option">
            <p class="student-option-name">{{student.full_name}}</p>
            <p class="student-option-meta">Grade {{student.grade_level}} - Section {{student.section}}</p>
          </button>
        } @empty {
          <p class="empty-state">No available students</p>
        }
      </div>
      <button (click)="showEnrollModal.set(false)"
              class="btn-close">
        Close
      </button>
    </div>
  </div>
}
