<div class="space-y-6">
  @if (subject()) {
    <div class="flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-bold text-slate-800">{{subject()!.subject_name}}</h2>
        <p class="text-slate-600">{{subject()!.subject_code}}</p>
      </div>
      <button (click)="router.navigate(['/take-attendance'])"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
        Take Attendance
      </button>
    </div>

    <!-- Tabs -->
    <div class="bg-white rounded-xl border shadow">
      <div class="flex border-b">
        <button (click)="activeTab.set('students')"
                [class]="'px-6 py-3 font-medium ' + (activeTab() === 'students' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-slate-600')">
          Enrolled Students
        </button>
        <button (click)="activeTab.set('attendance')"
                [class]="'px-6 py-3 font-medium ' + (activeTab() === 'attendance' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-slate-600')">
          Attendance Records
        </button>
      </div>

      <div class="p-6">
        @if (activeTab() === 'students') {
          <div class="space-y-4">
            <button (click)="showEnrollModal.set(true)"
                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
              + Enroll Student
            </button>
            @for (enrollment of enrollments(); track enrollment.enrollment_id) {
              <div class="flex items-center justify-between p-4 bg-slate-50 rounded-lg">
                <div>
                  <p class="font-medium">{{enrollment.student_name}}</p>
                  <p class="text-sm text-slate-600">Enrolled: {{formatDate(enrollment.enrolled_date)}}</p>
                </div>
                <button (click)="unenroll(enrollment.enrollment_id)"
                        class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                  Unenroll
                </button>
              </div>
            } @empty {
              <p class="text-center text-slate-500 py-8">No students enrolled</p>
            }
          </div>
        }

        @if (activeTab() === 'attendance') {
          <div class="space-y-2">
            @for (record of subjectAttendance(); track record.attendance_id) {
              <div class="flex items-center justify-between p-4 bg-slate-50 rounded-lg">
                <div>
                  <p class="font-medium">{{record.student_name}}</p>
                  <p class="text-sm text-slate-600">{{formatDate(record.date)}} - {{record.time}}</p>
                </div>
                <span [class]="getStatusClass(record.status)">{{record.status}}</span>
              </div>
            } @empty {
              <p class="text-center text-slate-500 py-8">No attendance records</p>
            }
          </div>
        }
      </div>
    </div>
  }
</div>

<!-- Enroll Modal -->
@if (showEnrollModal()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md max-h-96 overflow-y-auto">
      <h3 class="text-xl font-bold mb-4">Enroll Student</h3>
      <div class="space-y-2">
        @for (student of availableStudents(); track student.student_id) {
          <button (click)="enrollStudent(student)"
                  class="w-full text-left p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
            <p class="font-medium">{{student.full_name}}</p>
            <p class="text-sm text-slate-600">Grade {{student.grade_level}} - Section {{student.section}}</p>
          </button>
        } @empty {
          <p class="text-center text-slate-500 py-4">No available students</p>
        }
      </div>
      <button (click)="showEnrollModal.set(false)"
              class="mt-4 w-full px-4 py-2 bg-slate-200 rounded-md hover:bg-slate-300">
        Close
      </button>
    </div>
  </div>
}
